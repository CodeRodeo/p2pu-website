<script type="text/javascript">
//TODO:Move data into external file
var data = {
    "pois": [
      {
        "latitude": 15.341006,
        "longitude": 44.202889,
        "location": "Sana'a, Yemen",
        "title": "Let's Speak English"
      },
      {
        "latitude": 19.237273,
        "longitude": 72.787587,
        "location": "Gorai, India",
        "title": "Cheap Web Hosting"
      },
      {
        "latitude": 41.817587,
        "longitude": -87.694739,
        "location": "Chicago, IL, USA",
        "title": "Art of Storytelling"
      },
      {
        "latitude": 0.02896583659494138,
        "longitude": 37.62162219117033,
        "location": "Meru, Kenya",
        "title": "Data Detox"
      },
      {
        "latitude": 47.004173737910584,
        "longitude": 21.97320051982301,
        "location": "Sânmartin, Romania",
        "title": "Utilizarea tehnologiei in biblioteca școlară"
      },
      {
        "latitude": 37.684385128154204,
        "longitude": -97.33780224546243,
        "location": "Wichita, Kansas",
        "title": "Fiction Writing for Teens"
      }
    ]
  };

var accessToken = 'pk.eyJ1IjoiY29kZXJvZGVvIiwiYSI6ImNrdGM5M3N5eDIzcGsyb211anVhMGV2bXcifQ.25mHUrP-d-GnMFk22B65IQ';
var style = 'mapbox://styles/coderodeo/ckti45pap5uxr17p37qyp8j4y';

mapboxgl.accessToken = accessToken;
var map = new mapboxgl.Map({
  container: 'global-map',
  style: style,
  center:[154.31966822757704, 26.775160622365817],
  zoom: 1.5
});

//make sure whole map is showing
var bounds = [-22.08105693027528,-36.31799750813751,331.71425801660695, 76.42933790942402];
map.fitBounds(bounds);
map.on('resize', function(e){ map.fitBounds(bounds);})

//set markers & popups
var markers = [];
var popups = [];
$.each(data.pois, function(index, item) {
   const popup = new mapboxgl
   .Popup({ offset:25, closeButton:false, closeOnClick:true})
   .setHTML( "<strong>" + item.title + "</strong><br />" + item.location);
  
   const el = document.createElement('div');
   el.className = 'marker';  
   var m = new mapboxgl.Marker(el)
   .setLngLat([item.longitude, item.latitude])
   .setPopup(popup) // sets a popup on this marker
   .addTo(map);
   
   popups.push(popup);
   markers.push(m);
});  
var i = 0;
setInterval(e => {    
  for (var n = 0; n < popups.length; n++) { popups[n].remove();}
  markers[i].togglePopup();
  i++;
  if(i == markers.length){ i = 0;} 
}, 1500);

</script>
